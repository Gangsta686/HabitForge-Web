<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HabitForge ‚Äî –ö—É–∑–Ω–∏—Ü–∞ –ü—Ä–∏–≤—ã—á–µ–∫</title>
  <meta name="description" content="–ò–≥—Ä–æ–≤–æ–π —Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é">
  <!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è "—É—Å—Ç–∞–Ω–æ–≤–∫–∏" –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω -->
  <link rel="manifest" href="#"/>
  <style>
    :root {
      --primary: #2c6fbb;
      --danger: #d32f2f;
      --success: #388e3c;
      --light: #f9f9f9;
      --dark: #333;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      background-color: var(--light);
      color: var(--dark);
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin: 20px 0;
    }
    h1 {
      color: var(--primary);
      margin-bottom: 8px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin: 8px 0;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button.danger {
      background: var(--danger);
    }
    button.success {
      background: var(--success);
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    .progress {
      height: 12px;
      background: #eee;
      border-radius: 6px;
      margin: 12px 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s;
    }
    .hidden {
      display: none;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      color: #888;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <header>
    <h1>üî• HabitForge</h1>
    <p>–ö—É–∑–Ω–∏—Ü–∞ –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é</p>
  </header>

  <!-- –≠–∫—Ä–∞–Ω: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞ -->
  <div id="screen-start" class="card">
    <h2>–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π —á–µ–ª–ª–µ–Ω–¥–∂!</h2>
    <p>–ü–æ—Å—Ç–∞–≤—å—Ç–µ —Ü–µ–ª—å, –Ω–∞–∑–Ω–∞—á—å—Ç–µ "—Å—Ç–∞–≤–∫—É" ‚Äî –∏ –¥–æ–∫–∞–∂–∏—Ç–µ —Å–µ–±–µ, —á—Ç–æ –≤—ã —Å–∏–ª—å–Ω–µ–µ!</p>
    <button id="btn-new">‚ûï –ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω: –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞ -->
  <div id="screen-create" class="card hidden">
    <h2>–°–æ–∑–¥–∞–π—Ç–µ —á–µ–ª–ª–µ–Ω–¥–∂</h2>
    <input type="text" id="habit-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë–µ–≥–∞—Ç—å 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é" maxlength="100">
    <input type="number" id="bet-input" placeholder="–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (‚ÇΩ)" min="0" value="500">
    <select id="mode-select">
      <option value="charity">–í —Å–ª—É—á–∞–µ —Å—Ä—ã–≤–∞ ‚Äî –Ω–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
      <option value="pot">–í —Å–ª—É—á–∞–µ —Å—Ä—ã–≤–∞ ‚Äî –≤ –æ–±—â–∏–π –∫–æ—Ç—ë–ª (—Ä–æ–∑—ã–≥—Ä—ã—à)</option>
    </select>
    <button id="btn-create-confirm">‚úÖ –ù–∞—á–∞—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂</button>
    <button id="btn-create-cancel">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω: –ê–∫—Ç–∏–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ -->
  <div id="screen-active" class="card hidden">
    <h2 id="active-habit-title"></h2>
    <p>–°—Ç–∞–≤–∫–∞: <strong id="active-bet"></strong> ‚ÇΩ</p>
    <p>–†–µ–∂–∏–º: <span id="active-mode"></span></p>
    
    <div>–î–Ω–µ–π: <span id="days-done">0</span> / <span id="days-total">7</span></div>
    <div class="progress">
      <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
    </div>

    <button id="btn-mark-done" class="success">‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª —Å–µ–≥–æ–¥–Ω—è</button>
    <button id="btn-give-up" class="danger">üíÄ –°–¥–∞—Ç—å—Å—è (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞–≤–∫—É)</button>
    <button id="btn-active-cancel">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –≠–∫—Ä–∞–Ω: –ò—Ç–æ–≥ -->
  <div id="screen-result" class="card hidden">
    <h2 id="result-title"></h2>
    <p id="result-text"></p>
    <button id="btn-new-again">–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂</button>
  </div>

  <footer>
    –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
  </footer>

  <script>
    // === –•—Ä–∞–Ω–∏–ª–∏—â–µ ===
    let currentHabit = JSON.parse(localStorage.getItem('habitforge-habit')) || null;

    // === DOM —ç–ª–µ–º–µ–Ω—Ç—ã ===
    const screens = {
      start: document.getElementById('screen-start'),
      create: document.getElementById('screen-create'),
      active: document.getElementById('screen-active'),
      result: document.getElementById('screen-result'),
    };
    const btnNew = document.getElementById('btn-new');
    const btnCreateConfirm = document.getElementById('btn-create-confirm');
    const btnCreateCancel = document.getElementById('btn-create-cancel');
    const btnMarkDone = document.getElementById('btn-mark-done');
    const btnGiveUp = document.getElementById('btn-give-up');
    const btnActiveCancel = document.getElementById('btn-active-cancel');
    const btnNewAgain = document.getElementById('btn-new-again');

    // === –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ ===
    function showScreen(name) {
      Object.values(screens).forEach(s => s.classList.add('hidden'));
      screens[name].classList.remove('hidden');
    }

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    function init() {
      if (currentHabit && currentHabit.isActive) {
        renderActiveHabit();
        showScreen('active');
      } else {
        showScreen('start');
      }
    }

    // === –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞ ===
    btnNew.onclick = () => showScreen('create');
    btnCreateCancel.onclick = () => showScreen('start');
    btnActiveCancel.onclick = () => showScreen('start');

    btnCreateConfirm.onclick = () => {
      const habitText = document.getElementById('habit-input').value.trim();
      const bet = parseInt(document.getElementById('bet-input').value) || 0;
      const mode = document.getElementById('mode-select').value;

      if (!habitText) {
        alert('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å!');
        return;
      }

      currentHabit = {
        title: habitText,
        bet,
        mode,
        startDate: new Date().toISOString().split('T')[0],
        daysDone: 0,
        totalDays: 7,
        isActive: true,
        lastMarked: null, // —á—Ç–æ–±—ã –Ω–µ –æ—Ç–º–µ—Ç–∏—Ç—å –¥–≤–∞–∂–¥—ã –≤ –¥–µ–Ω—å
      };
      saveHabit();
      renderActiveHabit();
      showScreen('active');
    };

    // === –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ===
    btnMarkDone.onclick = () => {
      const today = new Date().toISOString().split('T')[0];
      if (currentHabit.lastMarked === today) {
        alert('–í—ã —É–∂–µ –æ—Ç–º–µ—Ç–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è!');
        return;
      }
      currentHabit.daysDone++;
      currentHabit.lastMarked = today;
      if (currentHabit.daysDone >= currentHabit.totalDays) {
        // –£—Å–ø–µ—Ö!
        showResult(true);
        currentHabit.isActive = false;
      } else {
        saveHabit();
        renderActiveHabit();
      }
    };

    // === –°–¥–∞—Ç—å—Å—è ===
    btnGiveUp.onclick = () => {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –°—Ç–∞–≤–∫–∞ –±—É–¥–µ—Ç "–ø–æ—Ç–µ—Ä—è–Ω–∞".')) {
        showResult(false);
        currentHabit.isActive = false;
        saveHabit();
      }
    };

    // === –ü–æ–∫–∞–∑–∞—Ç—å –∏—Ç–æ–≥ ===
    function showResult(success) {
      const title = success ? 'üéâ –£—Å–ø–µ—Ö!' : 'üíÄ –°—Ä—ã–≤';
      let text = success
        ? `–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —á–µ–ª–ª–µ–Ω–¥–∂ ¬´${currentHabit.title}¬ª!`
        : `–ß–µ–ª–ª–µ–Ω–¥–∂ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω. ${currentHabit.bet} ‚ÇΩ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ) `;
      
      if (!success) {
        text += currentHabit.mode === 'charity'
          ? '–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. ‚ù§Ô∏è'
          : '—É—à–ª–∏ –≤ –æ–±—â–∏–π –∫–æ—Ç—ë–ª. üé≤';
      }

      document.getElementById('result-title').textContent = title;
      document.getElementById('result-text').textContent = text;
      showScreen('result');
    }

    btnNewAgain.onclick = () => {
      currentHabit = null;
      localStorage.removeItem('habitforge-habit');
      showScreen('start');
    };

    // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞ ===
    function renderActiveHabit() {
      document.getElementById('active-habit-title').textContent = currentHabit.title;
      document.getElementById('active-bet').textContent = currentHabit.bet;
      document.getElementById('active-mode').textContent =
        currentHabit.mode === 'charity' ? '–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å' : '–û–±—â–∏–π –∫–æ—Ç—ë–ª';
      
      const done = currentHabit.daysDone;
      const total = currentHabit.totalDays;
      document.getElementById('days-done').textContent = done;
      document.getElementById('days-total').textContent = total;
      document.getElementById('progress-bar').style.width = (done / total * 100) + '%';
    }

    // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ===
    function saveHabit() {
      localStorage.setItem('habitforge-habit', JSON.stringify(currentHabit));
    }

    // === –ó–∞–ø—É—Å–∫ ===
    init();
  </script>
</body>
</html>